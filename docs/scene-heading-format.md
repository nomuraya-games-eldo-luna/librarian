# シーン見出しフォーマット仕様

**目的**: メタデータ自動生成スクリプトがシーンを確実に検出できるよう、見出しフォーマットを標準化する。

**最終更新**: 2025-12-28

---

## 📋 標準フォーマット

### 章見出し

```markdown
### **N 章：タイトル**
```

**例**:
```markdown
### **1 章：（未定）**
### **2 章：新たな力**
```

**ルール**:
- `###`（H3）を使用
- `**` で太字化
- 章番号は半角数字
- `章：` の後にタイトル

### シーン見出し

```markdown
#### **SCENE N：タイトル**
```

**例**:
```markdown
#### **SCENE 1：最初の選択、最初の仕事**
#### **SCENE 5：勝利への光明**
```

**ルール**:
- `####`（H4）を使用
- `**` で太字化
- `SCENE` は大文字
- シーン番号は半角数字
- `：`（全角コロン）を使用
- タイトルは日本語または英語

**正規表現パターン**:
```regex
^#### \*\*SCENE [0-9]+：.+\*\*$
```

---

## 🔍 検出スクリプト

### generate-metadata.sh の検出ロジック

```bash
# シーン見出しを検出
grep -n "^#### \*\*SCENE [0-9]\+：" "$SOURCE_FILE"

# 章見出しを検出
grep -m 1 "^###.*章" "$SOURCE_FILE"
```

---

## ❌ 禁止フォーマット

以下のフォーマットは使用しない（スクリプトが検出できない）:

```markdown
❌ ## Scene 5: タイトル          # H2は使わない、Sceneは小文字にしない
❌ ### シーン5：タイトル         # 「シーン」ではなく「SCENE」
❌ #### SCENE 5 - タイトル       # 「：」ではなく「-」
❌ #### **SCENE5：タイトル**     # スペースがない
❌ #### **scene 5：タイトル**    # 小文字は不可
```

---

## 🔄 リライト時のルール

**Ver1 → Ver2 → Ver3 とリライトする際も、フォーマットは変更しない**

**OK（フォーマット維持）**:
```markdown
# Ver1
#### **SCENE 5：勝利への光明**

# Ver2（タイトル変更）
#### **SCENE 5：希望の兆し**

# Ver3（シーン番号変更）
#### **SCENE 7：希望の兆し**
```

**NG（フォーマット変更）**:
```markdown
# Ver1
#### **SCENE 5：勝利への光明**

# Ver2（フォーマット変更 - NG）
## Scene 5: 希望の兆し  # ❌ スクリプトが検出できなくなる
```

---

## 📝 執筆AI向けガイドライン

**新規シーン作成時のテンプレート**:

```markdown
#### **SCENE N：タイトルをここに記入**

（本文）
```

**チェックポイント**:
- [ ] `####` から始まる
- [ ] `**SCENE` で続く（大文字）
- [ ] 半角スペースの後にシーン番号
- [ ] `：`（全角コロン）の後にタイトル
- [ ] 末尾は `**` で閉じる

---

## 🛠️ バリデーション

### 検証コマンド

```bash
# 全シーン見出しを検出（フォーマットチェック）
grep -n "^#### \*\*SCENE [0-9]\+：" docs/part1/chapter-1.md

# フォーマット違反を検出
grep -n "^####.*SCENE" docs/part1/chapter-1.md | \
  grep -v "^[0-9]\+:#### \*\*SCENE [0-9]\+："
```

### メタデータ自動生成でのバリデーション

```bash
# メタデータ生成時に自動的にフォーマットチェック
./.llms/scripts/generate-metadata.sh docs/part1/chapter-1.md --merge

# → フォーマット違反があればエラー出力
```

---

## 🔮 将来の拡張性

### 複数フォーマット対応（将来的に）

現在は単一フォーマットのみサポートだが、将来的には複数パターンに対応可能:

```bash
# 複数パターンを検出（将来の拡張案）
grep -nE "^#### \*\*SCENE [0-9]+[:：]|^#### SCENE [0-9]+:" docs/part1/chapter-1.md
```

ただし、**現時点では単一フォーマットに統一**することで、運用を簡素化する。

---

**このフォーマット仕様に従うことで、リライト時もメタデータ自動生成が確実に動作します。**
